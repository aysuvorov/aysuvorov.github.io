
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>

<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']]
  }
};
</script>
<script id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>

<img src="https://i.pinimg.com/564x/d6/0d/56/d60d56d0590e41ae363f42da31127a50.jpg" style="display: block; margin: 0 auto"/>

## Задания

- [Задания](#задания)
  - [Задание 1](#задание-1)

### Задание 2 - базовая загрузка таблицы

**Часть 1**

1. Скачать таблицу с данными [data](./df_maga.txt)
2. Переменные

```
group sex risk_sum_age_pre40 risk_score_category risk_score2_category risk_score2or_category risk_smart_category risk_advance_category smoking svd_amnesis menopause dm1 dm2 dm3 trt_hypoglik trt_insulin obesity dm_angioprthy ag_angiopathy chd angi angi_fc trt_statins trt_monoclol stroke_tia piks anemia chf gout gastritis asthma copd ag ag_control af aextr vextr atachy vtachy vpv ssu av_block trt_aarithm trt_ccb_nondyhidr trt_sota_meto trt_cordaron trt_allap trt_nitro trt_beta trt_ccb_dyhidr trt_apfinh trt_ara trt_diur trt_alpha_beta trt_iva trt_allopur trt_omnik trt_warf trt_dabi trt_riva trt_apix trt_asp trt_clop trt_tica trt_digo cckd albuminurea cancer pht rythm aort_valve tricus_valve mitral_valve dd artery_age
```

являются факторами / категориальными, остальные - количественными.

3. Оцените количество пропусков по каждой переменной, дайте статистики по пропускам в виде таблицы:

| Переменная | К-во наблюдений в таблице | К-во наблюдений в переменной |   Доля пропусков (%) по переменной    |
| ---------- | ------------------------- | ---------------------------- | ------------------------------------- |
| age        | 500                       | 450                          | *по формуле ((500 - 450)/500) x 100%* |
| ...        | ...                       | ...                          |                                       |

4. Дайте названия переменных с кол-вом пропусков свыше 15%, а также укажите долю пропусков в виде таблицы:

| Переменная | Доля пропусков (%) по переменной |
| ---------- | -------------------------------- |
| age        | 50%                              |
| ...        |                                  |

**Часть 2**

1. Дайте описательные статистики по всей таблице в следующем формате. 

В таблице должны быть колонки:

- `Индекс` или порядковый норер (просто, по порядку)
- `Название переменной` (для категориальных - может включать также названия категорий)
- `Категории` категориальных переменных (может быть совмещено с предыдущим столбцом)
- `Валидные,N` - количество непропущенных значений для данной переменной;
- `Абс,доля,%` - к-во значений соответствующей категории с указанием абс. значения и доли в скобках, доля округляется до 1 знака после запятой, формат вывода в примере; 
- `Среднее, ст.откл` - среднее ± стандартное отклонение для количественных переменных;
- `Медиана и размахи` - медиана и размахи для количественных переменных, формат вывода в примере, формат вывода в примере;
- `Мин` - минимум для количественных переменных;
- `Макс` - максимум для количественных переменных;
- `Тест Ш-У, значимость` - значимость теста Шапиро-Уилка для количественных переменных.

Пример таблицы по этим данным:

| Индекс |       Показатель       | Валидные,N | Абс,доля,%  | Среднее, ст.откл | Медиана и размахи | Мин  | Макс | Тест Ш-У, значимость |
| -----: | :--------------------- | :--------- | :---------- | :--------------- | :---------------- | :--- | :--- | -------------------: |
|      1 | **group**              |            |             |                  |                   |      |      |                      |
|      2 | 0                      | 413        | 92 (22.3%)  | -                | -                 | -    | -    |                      |
|      3 | 1                      | 413        | 321 (77.7%) | -                | -                 | -    | -    |                      |
|      4 | **age**                | 413        | -           | 55.4 ± 20.2      | 61.0 [39.0; 72.0] | 18.0 | 91.0 |                    0 |
|      5 | **sex**                |            |             |                  |                   |      |      |                      |
|      6 | 0                      | 413        | 221 (53.5%) | -                | -                 | -    | -    |                      |
|      7 | 1                      | 413        | 192 (46.5%) | -                | -                 | -    | -    |                      |
|      8 | **risk_sum_age_pre40** |            |             |                  |                   |      |      |                      |
|      9 | 1                      | 58         | 36 (62.1%)  | -                | -                 | -    | -    |                      |
|     10 | 2                      | 58         | 13 (22.4%)  | -                | -                 | -    | -    |                      |

В идеале, вы должны написать  функцию (или группу вложенных функций с некоей основной функцией), которая берет таблицу `pandas` или `r-data-frame/tibble` и выдает таблицу с рассчитанными статистиками. 


### Задание 1

Напишите функцию, которая в качестве аргументов:

- берет 2 массива значений - реальные классы и предсказанные,
- значение параметра `random seed`, по умолчанию оно будет 0,
- тип выходной таблицы - таблица  `pandas` или `markdown`, по умолчанию `markdown`

(Что такое random seed можно почитать [здесь](https://en.wikipedia.org/wiki/Random_seed))

Для предсказанного массива нужно рассчитать:

- AUC
- Sensitivity
- Specificity
- NPV
- PPV
- Accuracy
- Balanced accuracy

- вишенка на торте - рассчитать также 95% ДИ вышеуказанных статистик.
Используйте для этого бутстреп с соответствующим `random seed`.

Вывод функции - в виде таблицы `pandas` или `markdown`

Таблица должна быть следующего вида:

| Параметр | Статистика |    95% ДИ     |
| -------- | ---------- | ------------- |
| AUC      | 0.68       | (0.45 - 0.84) |
| ...      | ...        | ...           |

**Массивы:**

```
real_values = [0,1,1,0,1,0,1,1,0,0,0,1,1,0,0,1,0,1,0,1,0]
predicted_values = [0,1,0,1,1,0,0,1,0,1,1,1,1,0,1,0,0,1,1,0,0]
```
